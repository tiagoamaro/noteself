<%= form_with(model: note, class: "contents") do |form| %>
  <% if note.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-md mt-3">
      <h2><%= pluralize(note.errors.count, "error") %> prohibited this note from being saved:</h2>

      <ul class="list-disc ml-6">
        <% note.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="my-5">
    <%= form.label :title %>
    <%= form.text_field :title, class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": note.errors[:title].none?, "border-red-400 focus:outline-red-600": note.errors[:title].any?}], data: { note_sync_target: "title" } %>
  </div>

  <div class="my-5">
    <%= form.label :body %>
    <div class="flex flex-row gap-5 mt-2">
      <div class="w-1/2 md:relative">
        <div data-note-sync-target="spinnerContainer" class="fixed top-4 right-4 md:absolute md:top-0 md:right-0 z-50 bg-white border border-gray-300 rounded-lg shadow-md p-2 hidden">
          <div class="relative w-5 h-5">
            <span data-note-sync-target="spinner" class="absolute inset-0 opacity-0 scale-0 transition-all duration-300 ease-in-out">
              <%= lucide_icon("loader-2", class: "w-5 h-5 text-blue-600 animate-spin") %>
            </span>
            <span data-note-sync-target="successIcon" class="absolute inset-0 opacity-0 scale-0 transition-all duration-300 ease-in-out">
              <%= lucide_icon("check-square", class: "w-5 h-5 text-green-600") %>
            </span>
          </div>
        </div>
        <%= form.text_area :body, rows: 15, class: ["block shadow-sm rounded-md border px-3 py-2 w-full", {"border-gray-400 focus:outline-blue-600": note.errors[:body].none?, "border-red-400 focus:outline-red-600": note.errors[:body].any?}], data: { note_sync_target: "body", controller: "textarea-shortcuts" } %>
      </div>
      <div class="w-1/2">
        <div class="p-4" data-note-sync-target="preview">
          <%= turbo_frame_tag "note_preview", src: note.persisted? ? preview_note_path(note) : nil do %>
            <div class="prose prose-sm max-w-none">
              <%= render_markdown(note.body || "", truncate: false) %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <% if note.new_record? %>
    <div class="inline">
      <%= form.submit class: "w-full sm:w-auto rounded-md px-3.5 py-2.5 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" %>
    </div>
  <% end %>
<% end %>
